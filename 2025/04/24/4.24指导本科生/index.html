<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>带带大师兄营业了 | Whz's Note</title><meta name="author" content="Whz"><meta name="copyright" content="Whz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="4月24日,今天事情好多啊,下午开组会指导本科生写论文,晚上还得给本科生改代码。Causal Partial Label Learning因果表征偏标记学习 数据集的两大挑战领域外泛化问题(Out-Of-Distribution)  候选标签集合(Nosiy-Labels)  计划如下             检查论文内容                           检查论文公式">
<meta property="og:type" content="article">
<meta property="og:title" content="带带大师兄营业了">
<meta property="og:url" content="https://whzree.github.io/2025/04/24/4.24%E6%8C%87%E5%AF%BC%E6%9C%AC%E7%A7%91%E7%94%9F/index.html">
<meta property="og:site_name" content="Whz&#39;s Note">
<meta property="og:description" content="4月24日,今天事情好多啊,下午开组会指导本科生写论文,晚上还得给本科生改代码。Causal Partial Label Learning因果表征偏标记学习 数据集的两大挑战领域外泛化问题(Out-Of-Distribution)  候选标签集合(Nosiy-Labels)  计划如下             检查论文内容                           检查论文公式">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p2.bahamut.com.tw/B/2KU/23/dc4ae8f8e7b1e6ba410795ebb51to275.JPG?w=1000">
<meta property="article:published_time" content="2025-04-24T09:14:01.155Z">
<meta property="article:modified_time" content="2025-04-24T10:23:39.023Z">
<meta property="article:author" content="Whz">
<meta property="article:tag" content="教程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p2.bahamut.com.tw/B/2KU/23/dc4ae8f8e7b1e6ba410795ebb51to275.JPG?w=1000"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "带带大师兄营业了",
  "url": "https://whzree.github.io/2025/04/24/4.24%E6%8C%87%E5%AF%BC%E6%9C%AC%E7%A7%91%E7%94%9F/",
  "image": "https://p2.bahamut.com.tw/B/2KU/23/dc4ae8f8e7b1e6ba410795ebb51to275.JPG?w=1000",
  "datePublished": "2025-04-24T09:14:01.155Z",
  "dateModified": "2025-04-24T10:23:39.023Z",
  "author": [
    {
      "@type": "Person",
      "name": "Whz",
      "url": "https://whzree.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://whzree.github.io/2025/04/24/4.24%E6%8C%87%E5%AF%BC%E6%9C%AC%E7%A7%91%E7%94%9F/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/img/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/img/pwa/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/pwa/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/pwa/16.png"/><link rel="mask-icon" href="/img/pwa/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '带带大师兄营业了',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/self.css"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_2264842_b004iy0kk2b.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/cat.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><div id="myscoll"></div><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(images/Mario/img_2.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/Mario/img_1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://p2.bahamut.com.tw/B/2KU/23/dc4ae8f8e7b1e6ba410795ebb51to275.JPG?w=1000);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/Mario/img.png" alt="Logo"><span class="site-name">Whz's Note</span></a><a class="nav-page-title" href="/"><span class="site-name">带带大师兄营业了</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">带带大师兄营业了<a class="post-edit-link" href="null_posts/4.24指导本科生.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-24T09:14:01.155Z" title="发表于 2025-04-24 17:14:01">2025-04-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-24T10:23:39.023Z" title="更新于 2025-04-24 18:23:39">2025-04-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><strong><em>4月24日,今天事情好多啊,下午开组会指导本科生写论文,晚上还得给本科生改代码。</em></strong><br><p class='p cyan center logo large'>Causal Partial Label Learning</p><br><p class='p center small'>因果表征偏标记学习</p></p>
<h1 id="数据集的两大挑战"><a href="#数据集的两大挑战" class="headerlink" title="数据集的两大挑战"></a>数据集的两大挑战</h1><div class="tip info animated-hover"><p>领域外泛化问题(Out-Of-Distribution)</p>
</div>
<div class="tip info animated-hover"><p>候选标签集合(Nosiy-Labels)</p>
</div>
<h1 id="计划如下"><a href="#计划如下" class="headerlink" title="计划如下"></a>计划如下</h1><div class='checkbox orange checked'><input type="checkbox" checked="checked"/>
            <p>检查论文内容</p>
            </div>
<div class='checkbox green'><input type="checkbox" />
            <p>检查论文公式</p>
            </div>
<div class='checkbox yellow'><input type="checkbox" />
            <p>检查论文引用</p>
            </div>
<div class='checkbox cyan'><input type="checkbox" />
            <p>检查论文格式</p>
            </div>
<div class='checkbox blue'><input type="checkbox" />
            <p>改模型改代码</p>
            </div>
<div class='checkbox red'><input type="checkbox" />
            <p>写实验写总结</p>
            </div>
<div class='checkbox red'><input type="checkbox" />
            <p>提交</p>
            </div>
<div class="img-wrap"><div class="img-bg"><img class="img" src="/images/Mario/img_3.png"/></div></div>
<p class='p center small'>这是模型流程图</p>
<div class="img-wrap"><div class="img-bg"><img class="img" src="/images/Mario/img_4.png"/></div></div>
<p class='p center small'>这是模型结果图</p>
<h1 id="偏标记代码"><a href="#偏标记代码" class="headerlink" title="偏标记代码"></a>偏标记代码</h1><details class="folding-tag" blue><summary> 偏标记构造函数 </summary>
              <div class='content'>
              <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#对标签 y 进行独热编码并转化为torch向量</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binarize_class</span>(<span class="params">y</span>):  </span><br><span class="line">    label = y.reshape(<span class="built_in">len</span>(y), -<span class="number">1</span>)</span><br><span class="line">    enc = OneHotEncoder(categories=<span class="string">&#x27;auto&#x27;</span>) </span><br><span class="line">    enc.fit(label)</span><br><span class="line">    label = enc.transform(label).toarray().astype(np.float32)     </span><br><span class="line">    label = torch.from_numpy(label)</span><br><span class="line">    <span class="keyword">return</span> label</span><br><span class="line"></span><br><span class="line"><span class="comment">#对标签进行加噪声,</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">partialize</span>(<span class="params">y, y0, t, p</span>):</span><br><span class="line">    <span class="comment"># 定义一个名为 partialize 的函数，它接收四个参数：</span></span><br><span class="line">    <span class="comment"># y: 一个 PyTorch 张量，通常表示类别标签的概率分布</span></span><br><span class="line">    <span class="comment"># y0: 可能是原始的真实标签</span></span><br><span class="line">    <span class="comment"># t: 一个字符串，用于指定处理的类型，有 &#x27;binomial&#x27; 和 &#x27;pair&#x27; 两种选择</span></span><br><span class="line">    <span class="comment"># p: 一个概率值，用于随机过程</span></span><br><span class="line">    new_y = y.clone()</span><br><span class="line">    n, c = y.shape[<span class="number">0</span>], y.shape[<span class="number">1</span>]</span><br><span class="line">    avgC = <span class="number">0</span></span><br><span class="line">    <span class="comment"># 初始化一个变量 avgC，用于记录所有样本中激活类别的平均数量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> t==<span class="string">&#x27;binomial&#x27;</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            row = new_y[i, :] </span><br><span class="line">            row[np.where(np.random.binomial(<span class="number">1</span>, p, c)==<span class="number">1</span>)] = <span class="number">1</span></span><br><span class="line">            <span class="comment"># 使用 np.random.binomial(1, p, c) 生成一个长度为 c 的二项分布随机数组，</span></span><br><span class="line">            <span class="comment"># 其中每个元素以概率 p 取值为 1，以概率 1 - p 取值为 0。</span></span><br><span class="line">            <span class="comment"># np.where 找出取值为 1 的元素的索引，将 row 中对应索引的元素设置为 1</span></span><br><span class="line">            <span class="keyword">while</span> torch.<span class="built_in">sum</span>(row) == <span class="number">1</span>:</span><br><span class="line">                row[np.random.randint(<span class="number">0</span>, c)] = <span class="number">1</span></span><br><span class="line">            avgC += torch.<span class="built_in">sum</span>(row)</span><br><span class="line">            <span class="comment"># 累加当前行中激活类别的数量到 avgC</span></span><br><span class="line">            new_y[i] = row / torch.<span class="built_in">sum</span>(row)</span><br><span class="line">            <span class="comment"># 对当前行进行归一化处理，使所有元素之和为 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> t==<span class="string">&#x27;pair&#x27;</span>:</span><br><span class="line">        P = np.eye(c)</span><br><span class="line">        <span class="comment"># 创建一个 c x c 的单位矩阵 P</span></span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, c-<span class="number">1</span>):</span><br><span class="line">            P[idx, idx], P[idx, idx+<span class="number">1</span>] = <span class="number">1</span>, p</span><br><span class="line">            <span class="comment"># 将矩阵 P 中第 idx 行的第 idx 个元素设置为 1，第 idx + 1 个元素设置为 p</span></span><br><span class="line">        P[c-<span class="number">1</span>, c-<span class="number">1</span>], P[c-<span class="number">1</span>, <span class="number">0</span>] = <span class="number">1</span>, p</span><br><span class="line">        <span class="comment"># 将矩阵 P 的最后一行的最后一个元素设置为 1，第一个元素设置为 p</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            row = new_y[i, :]</span><br><span class="line">            idx = y0[i] </span><br><span class="line">            row[np.where(np.random.binomial(<span class="number">1</span>, P[idx, :], c)==<span class="number">1</span>)] = <span class="number">1</span></span><br><span class="line">            <span class="comment"># 根据原始真实标签 idx 从矩阵 P 中获取一行概率分布，</span></span><br><span class="line">            <span class="comment"># 使用 np.random.binomial(1, P[idx, :], c) 生成一个长度为 c 的二项分布随机数组，</span></span><br><span class="line">            <span class="comment"># 找出取值为 1 的元素的索引，将 row 中对应索引的元素设置为 1</span></span><br><span class="line">            avgC += torch.<span class="built_in">sum</span>(row)</span><br><span class="line">            new_y[i] = row / torch.<span class="built_in">sum</span>(row)</span><br><span class="line"></span><br><span class="line">    avgC = avgC / n    </span><br><span class="line">    <span class="keyword">return</span> new_y, avgC</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" cyan><summary> 偏标记数据集构造函数 </summary>
              <div class='content'>
              <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pickle </span><br><span class="line"><span class="keyword">import</span> torch.utils.data <span class="keyword">as</span> data</span><br><span class="line"><span class="keyword">from</span> utils.utils_algo <span class="keyword">import</span> binarize_class, partialize, check_integrity, download_url</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cifar10</span>(data.Dataset):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;`CIFAR10 &lt;https://www.cs.toronto.edu/~kriz/cifar.html&gt;`_ Dataset.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        root (string): Root directory of dataset where directory</span></span><br><span class="line"><span class="string">            ``cifar-10-batches-py`` exists or will be saved to if download is set to True.</span></span><br><span class="line"><span class="string">        train (bool, optional): If True, creates dataset from training set, otherwise</span></span><br><span class="line"><span class="string">            creates from test set.</span></span><br><span class="line"><span class="string">        transform (callable, optional): A function/transform that  takes in an PIL image</span></span><br><span class="line"><span class="string">            and returns a transformed version. E.g, ``transforms.RandomCrop``</span></span><br><span class="line"><span class="string">        target_transform (callable, optional): A function/transform that takes in the</span></span><br><span class="line"><span class="string">            target and transforms it.</span></span><br><span class="line"><span class="string">        download (bool, optional): If true, downloads the dataset from the internet and</span></span><br><span class="line"><span class="string">            puts it in root directory. If dataset is already downloaded, it is not</span></span><br><span class="line"><span class="string">            downloaded again.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    base_folder = <span class="string">&#x27;cifar-10-batches-py&#x27;</span> </span><br><span class="line">    url = <span class="string">&#x27;http://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz&#x27;</span></span><br><span class="line">    filename = <span class="string">&#x27;cifar-10-python.tar.gz&#x27;</span></span><br><span class="line">    tgz_md5 = <span class="string">&#x27;c58f30108f718f92721af3b95e74349a&#x27;</span> </span><br><span class="line">    train_list = [</span><br><span class="line">        [<span class="string">&#x27;data_batch_1&#x27;</span>, <span class="string">&#x27;c99cafc152244af753f735de768cd75f&#x27;</span>],</span><br><span class="line">        [<span class="string">&#x27;data_batch_2&#x27;</span>, <span class="string">&#x27;d4bba439e000b95fd0a9bffe97cbabec&#x27;</span>],</span><br><span class="line">        [<span class="string">&#x27;data_batch_3&#x27;</span>, <span class="string">&#x27;54ebc095f3ab1f0389bbae665268c751&#x27;</span>],</span><br><span class="line">        [<span class="string">&#x27;data_batch_4&#x27;</span>, <span class="string">&#x27;634d18415352ddfa80567beed471001a&#x27;</span>],</span><br><span class="line">        [<span class="string">&#x27;data_batch_5&#x27;</span>, <span class="string">&#x27;482c414d41f54cd18b22e5b47cb7c3cb&#x27;</span>],</span><br><span class="line">    ]</span><br><span class="line">    test_list = [</span><br><span class="line">        [<span class="string">&#x27;test_batch&#x27;</span>, <span class="string">&#x27;40351d587109b95175f43aff81a1287e&#x27;</span>],</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, root, train_or_not=<span class="literal">True</span>, download=<span class="literal">False</span>, transform=<span class="literal">None</span>, target_transform=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">                 partial_type=<span class="string">&#x27;binomial&#x27;</span>, partial_rate=<span class="number">0.1</span>, random_state=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.root = os.path.expanduser(root)</span><br><span class="line">        <span class="variable language_">self</span>.transform = transform</span><br><span class="line">        <span class="variable language_">self</span>.target_transform = target_transform</span><br><span class="line">        <span class="variable language_">self</span>.train = train_or_not</span><br><span class="line">        <span class="variable language_">self</span>.dataset = <span class="string">&#x27;cifar10&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> download:</span><br><span class="line">            <span class="variable language_">self</span>.download()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._check_integrity():</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Dataset not found or corrupted.&#x27;</span> +</span><br><span class="line">                               <span class="string">&#x27; You can use download=True to download it&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.train:</span><br><span class="line">            <span class="variable language_">self</span>.train_data = []</span><br><span class="line">            <span class="variable language_">self</span>.train_labels = []</span><br><span class="line">            <span class="keyword">for</span> fentry <span class="keyword">in</span> <span class="variable language_">self</span>.train_list:</span><br><span class="line">                f = fentry[<span class="number">0</span>]</span><br><span class="line">                file = os.path.join(<span class="variable language_">self</span>.root, <span class="variable language_">self</span>.base_folder, f)</span><br><span class="line">                fo = <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">                entry = pickle.load(fo, encoding=<span class="string">&#x27;latin1&#x27;</span>) </span><br><span class="line">                <span class="variable language_">self</span>.train_data.append(entry[<span class="string">&#x27;data&#x27;</span>])</span><br><span class="line">                <span class="variable language_">self</span>.train_labels += entry[<span class="string">&#x27;labels&#x27;</span>]</span><br><span class="line">                fo.close()</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.train_data = np.concatenate(<span class="variable language_">self</span>.train_data) </span><br><span class="line">            <span class="variable language_">self</span>.train_data = <span class="variable language_">self</span>.train_data.reshape((<span class="number">50000</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>))</span><br><span class="line">            <span class="variable language_">self</span>.train_data = <span class="variable language_">self</span>.train_data.transpose((<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>)) </span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.train_data = torch.from_numpy(<span class="variable language_">self</span>.train_data)</span><br><span class="line">            <span class="variable language_">self</span>.train_labels = torch.tensor(<span class="variable language_">self</span>.train_labels, dtype=torch.long)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> partial_rate != <span class="number">0.0</span>:</span><br><span class="line">                y = binarize_class(<span class="variable language_">self</span>.train_labels) </span><br><span class="line">                <span class="variable language_">self</span>.train_final_labels, <span class="variable language_">self</span>.average_class_label = partialize(y, <span class="variable language_">self</span>.train_labels, partial_type, partial_rate)    </span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="variable language_">self</span>.train_final_labels = binarize_class(<span class="variable language_">self</span>.train_labels).<span class="built_in">float</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            f = <span class="variable language_">self</span>.test_list[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">            file = os.path.join(<span class="variable language_">self</span>.root, <span class="variable language_">self</span>.base_folder, f)</span><br><span class="line">            fo = <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> sys.version_info[<span class="number">0</span>] == <span class="number">2</span>: </span><br><span class="line">                entry = pickle.load(fo)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                entry = pickle.load(fo, encoding=<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.test_data = entry[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">            <span class="variable language_">self</span>.test_labels = entry[<span class="string">&#x27;labels&#x27;</span>]</span><br><span class="line">            fo.close()</span><br><span class="line">            <span class="variable language_">self</span>.test_data = <span class="variable language_">self</span>.test_data.reshape((<span class="number">10000</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>))</span><br><span class="line">            <span class="variable language_">self</span>.test_data = <span class="variable language_">self</span>.test_data.transpose((<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>)) </span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>.test_data = torch.from_numpy(<span class="variable language_">self</span>.test_data)</span><br><span class="line">            <span class="variable language_">self</span>.test_labels = torch.tensor(<span class="variable language_">self</span>.test_labels, dtype=torch.long)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            index (int): Index</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            tuple: (image, target) where target is index of the target class.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.train:</span><br><span class="line">            img, target, true = <span class="variable language_">self</span>.train_data[index], <span class="variable language_">self</span>.train_final_labels[index], <span class="variable language_">self</span>.train_labels[index]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            img, target, true = <span class="variable language_">self</span>.test_data[index], <span class="variable language_">self</span>.test_labels[index], <span class="variable language_">self</span>.test_labels[index]</span><br><span class="line"></span><br><span class="line">        img = Image.fromarray(img.numpy(), mode=<span class="literal">None</span>) </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.transform <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            img = <span class="variable language_">self</span>.transform(img)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.target_transform <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            target = <span class="variable language_">self</span>.target_transform(target)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> img, target, true, index</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.train:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.train_data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.test_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_integrity</span>(<span class="params">self</span>):</span><br><span class="line">        root = <span class="variable language_">self</span>.root</span><br><span class="line">        <span class="keyword">for</span> fentry <span class="keyword">in</span> (<span class="variable language_">self</span>.train_list + <span class="variable language_">self</span>.test_list):</span><br><span class="line">            filename, md5 = fentry[<span class="number">0</span>], fentry[<span class="number">1</span>]</span><br><span class="line">            fpath = os.path.join(root, <span class="variable language_">self</span>.base_folder, filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check_integrity(fpath, md5): </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">import</span> tarfile </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._check_integrity():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        download_url(<span class="variable language_">self</span>.url, <span class="variable language_">self</span>.root, <span class="variable language_">self</span>.filename, <span class="variable language_">self</span>.tgz_md5) </span><br><span class="line"></span><br><span class="line">        cwd = os.getcwd() </span><br><span class="line">        tar = tarfile.<span class="built_in">open</span>(os.path.join(<span class="variable language_">self</span>.root, <span class="variable language_">self</span>.filename), <span class="string">&quot;r:gz&quot;</span>) </span><br><span class="line">        os.chdir(<span class="variable language_">self</span>.root)</span><br><span class="line">        tar.extractall()</span><br><span class="line">        tar.close()</span><br><span class="line">        os.chdir(cwd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        fmt_str = <span class="string">&#x27;Dataset &#x27;</span> + <span class="variable language_">self</span>.__class__.__name__ + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        fmt_str += <span class="string">&#x27;    Number of datapoints: &#123;&#125;\n&#x27;</span>.<span class="built_in">format</span>(<span class="variable language_">self</span>.__len__())</span><br><span class="line">        tmp = <span class="string">&#x27;train&#x27;</span> <span class="keyword">if</span> <span class="variable language_">self</span>.train <span class="keyword">is</span> <span class="literal">True</span> <span class="keyword">else</span> <span class="string">&#x27;test&#x27;</span></span><br><span class="line">        fmt_str += <span class="string">&#x27;    Split: &#123;&#125;\n&#x27;</span>.<span class="built_in">format</span>(tmp)</span><br><span class="line">        fmt_str += <span class="string">&#x27;    Root Location: &#123;&#125;\n&#x27;</span>.<span class="built_in">format</span>(<span class="variable language_">self</span>.root)</span><br><span class="line">        tmp = <span class="string">&#x27;    Transforms (if any): &#x27;</span></span><br><span class="line">        fmt_str += <span class="string">&#x27;&#123;0&#125;&#123;1&#125;\n&#x27;</span>.<span class="built_in">format</span>(tmp, <span class="variable language_">self</span>.transform.__repr__().replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\n&#x27;</span> + <span class="string">&#x27; &#x27;</span> * <span class="built_in">len</span>(tmp)))</span><br><span class="line">        tmp = <span class="string">&#x27;    Target Transforms (if any): &#x27;</span></span><br><span class="line">        fmt_str += <span class="string">&#x27;&#123;0&#125;&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(tmp, <span class="variable language_">self</span>.target_transform.__repr__().replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\n&#x27;</span> + <span class="string">&#x27; &#x27;</span> * <span class="built_in">len</span>(tmp)))</span><br><span class="line">        <span class="keyword">return</span> fmt_str</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h3 id="消歧损失函数可以改进-这里是基础消歧损失函数-baseline-Loss-Function"><a href="#消歧损失函数可以改进-这里是基础消歧损失函数-baseline-Loss-Function" class="headerlink" title="消歧损失函数可以改进,这里是基础消歧损失函数,baseline Loss Function"></a>消歧损失函数可以改进,这里是基础消歧损失函数,baseline Loss Function</h3><details class="folding-tag" green><summary> 原始消歧损失函数 </summary>
              <div class='content'>
              <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch </span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">partial_loss</span>(<span class="params">output1, target, true</span>):</span><br><span class="line">    output = F.softmax(output1, dim=<span class="number">1</span>)</span><br><span class="line">    l = target * torch.log(output)</span><br><span class="line">    loss = (-torch.<span class="built_in">sum</span>(l)) / l.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    revisedY = target.clone()</span><br><span class="line">    revisedY[revisedY &gt; <span class="number">0</span>]  = <span class="number">1</span></span><br><span class="line">    revisedY = revisedY * output</span><br><span class="line">    revisedY = revisedY / revisedY.<span class="built_in">sum</span>(dim=<span class="number">1</span>).repeat(revisedY.size(<span class="number">1</span>),<span class="number">1</span>).transpose(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    new_target = revisedY</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> loss, new_target</span><br><span class="line"><span class="comment">#权重逐步更新过程</span></span><br><span class="line"><span class="comment">#net 模型</span></span><br><span class="line">            output = net(images)</span><br><span class="line">            loss, new_label = partial_loss(output, labels, trues)</span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            loss.backward()</span><br><span class="line">            optimizer.step()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># update weights</span></span><br><span class="line">            <span class="keyword">for</span> j, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(indexes):</span><br><span class="line">                train_loader.dataset.train_final_labels[k,:] = new_label[j,:].detach()</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h1 id="领域外泛化代码"><a href="#领域外泛化代码" class="headerlink" title="领域外泛化代码"></a>领域外泛化代码</h1><details class="folding-tag" yellow><summary> 查看代码测试 </summary>
              <div class='content'>
              <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> models.model_factory <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> optimizer.optimizer_helper <span class="keyword">import</span> get_optim_and_scheduler</span><br><span class="line"><span class="keyword">from</span> data <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> utils.Logger <span class="keyword">import</span> Logger</span><br><span class="line"><span class="keyword">from</span> utils.tools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> models.classifier <span class="keyword">import</span> Masker</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"><span class="keyword">from</span> warnings <span class="keyword">import</span> simplefilter</span><br><span class="line">simplefilter(action=<span class="string">&#x27;ignore&#x27;</span>, category=FutureWarning)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_args</span>():</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    <span class="comment">#定义一个命令行参数,表示源域(source domain)用户可以通过命令行指定源域例如--source dataset1 dateset2</span></span><br><span class="line">    <span class="comment">#choices 这个参数限制用户只能选择 available_datasets 列表中的数据集作为源域。</span></span><br><span class="line">    <span class="comment">#nargs 参数定义了命令行参数应该接受的值的数量。&#x27;+&#x27; 表示用户可以输入一个或多个源域数据集。</span></span><br><span class="line">    <span class="comment"># 例如，用户可以输入 --source dataset1 dataset2 dataset3。</span></span><br><span class="line">    parser.add_argument(<span class="string">&quot;--source&quot;</span>, choices=available_datasets, <span class="built_in">help</span>=<span class="string">&quot;Source&quot;</span>, nargs=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">    <span class="comment"># 选择一个目标域</span></span><br><span class="line">    parser.add_argument(<span class="string">&quot;--target&quot;</span>, choices=available_datasets, <span class="built_in">help</span>=<span class="string">&quot;Target&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--input_dir&quot;</span>, default=<span class="literal">None</span>, <span class="built_in">help</span>=<span class="string">&quot;The directory of dataset lists&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--output_dir&quot;</span>, default=<span class="literal">None</span>, <span class="built_in">help</span>=<span class="string">&quot;The directory to save logs and models&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--config&quot;</span>, default=<span class="literal">None</span>, <span class="built_in">help</span>=<span class="string">&quot;Experiment configs&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--tf_logger&quot;</span>, <span class="built_in">type</span>=ast.literal_eval, default=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;If true will save tensorboard compatible logs&quot;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    config_file = <span class="string">&quot;config.&quot;</span> + args.config.replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\nLoading experiment <span class="subst">&#123;args.config&#125;</span>\n&quot;</span>)</span><br><span class="line">    config = <span class="built_in">__import__</span>(config_file, fromlist=[<span class="string">&quot;&quot;</span>]).config</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> args, config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Trainer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, args, config, device</span>):</span><br><span class="line">        <span class="variable language_">self</span>.args = args</span><br><span class="line">        <span class="variable language_">self</span>.config = config</span><br><span class="line">        <span class="variable language_">self</span>.device = device</span><br><span class="line">        <span class="variable language_">self</span>.global_step = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># networks</span></span><br><span class="line">        <span class="variable language_">self</span>.encoder = get_encoder_from_config(<span class="variable language_">self</span>.config[<span class="string">&quot;networks&quot;</span>][<span class="string">&quot;encoder&quot;</span>]).to(device)</span><br><span class="line">        <span class="variable language_">self</span>.classifier = get_classifier_from_config(<span class="variable language_">self</span>.config[<span class="string">&quot;networks&quot;</span>][<span class="string">&quot;classifier&quot;</span>]).to(device)</span><br><span class="line">        <span class="variable language_">self</span>.classifier_ad = get_classifier_from_config(<span class="variable language_">self</span>.config[<span class="string">&quot;networks&quot;</span>][<span class="string">&quot;classifier&quot;</span>]).to(device)</span><br><span class="line">        dim = <span class="variable language_">self</span>.config[<span class="string">&quot;networks&quot;</span>][<span class="string">&quot;classifier&quot;</span>][<span class="string">&quot;in_dim&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.masker = Masker(in_dim=dim, num_classes = dim,middle = <span class="number">4</span>*dim,k=<span class="variable language_">self</span>.config[<span class="string">&quot;k&quot;</span>]).to(device)</span><br><span class="line">       </span><br><span class="line">        <span class="comment"># optimizers</span></span><br><span class="line">        <span class="variable language_">self</span>.encoder_optim, <span class="variable language_">self</span>.encoder_sched = \</span><br><span class="line">            get_optim_and_scheduler(<span class="variable language_">self</span>.encoder, <span class="variable language_">self</span>.config[<span class="string">&quot;optimizer&quot;</span>][<span class="string">&quot;encoder_optimizer&quot;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.classifier_optim, <span class="variable language_">self</span>.classifier_sched = \</span><br><span class="line">            get_optim_and_scheduler(<span class="variable language_">self</span>.classifier, <span class="variable language_">self</span>.config[<span class="string">&quot;optimizer&quot;</span>][<span class="string">&quot;classifier_optimizer&quot;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.classifier_ad_optim, <span class="variable language_">self</span>.classifier_ad_sched = \</span><br><span class="line">            get_optim_and_scheduler(<span class="variable language_">self</span>.classifier_ad, <span class="variable language_">self</span>.config[<span class="string">&quot;optimizer&quot;</span>][<span class="string">&quot;classifier_optimizer&quot;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.masker_optim, <span class="variable language_">self</span>.masker_sched = \</span><br><span class="line">            get_optim_and_scheduler(<span class="variable language_">self</span>.masker, <span class="variable language_">self</span>.config[<span class="string">&quot;optimizer&quot;</span>][<span class="string">&quot;classifier_optimizer&quot;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># dataloaders</span></span><br><span class="line">        <span class="variable language_">self</span>.train_loader = get_fourier_train_dataloader(args=<span class="variable language_">self</span>.args, config=<span class="variable language_">self</span>.config)</span><br><span class="line">        <span class="variable language_">self</span>.val_loader = get_val_dataloader(args=<span class="variable language_">self</span>.args, config=<span class="variable language_">self</span>.config)</span><br><span class="line">        <span class="variable language_">self</span>.test_loader = get_test_loader(args=<span class="variable language_">self</span>.args, config=<span class="variable language_">self</span>.config)</span><br><span class="line">        <span class="variable language_">self</span>.eval_loader = &#123;<span class="string">&#x27;val&#x27;</span>: <span class="variable language_">self</span>.val_loader, <span class="string">&#x27;test&#x27;</span>: <span class="variable language_">self</span>.test_loader&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_do_epoch</span>(<span class="params">self</span>):</span><br><span class="line">        criterion = nn.CrossEntropyLoss()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># turn on train mode</span></span><br><span class="line">        <span class="variable language_">self</span>.encoder.train()</span><br><span class="line">        <span class="variable language_">self</span>.classifier.train()</span><br><span class="line">        <span class="variable language_">self</span>.classifier_ad.train()</span><br><span class="line">        <span class="variable language_">self</span>.masker.train()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> it, (batch, label, domain) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="variable language_">self</span>.train_loader):</span><br><span class="line"></span><br><span class="line">            <span class="comment"># preprocessing</span></span><br><span class="line">            batch = torch.cat(batch, dim=<span class="number">0</span>).to(<span class="variable language_">self</span>.device)</span><br><span class="line">            labels = torch.cat(label, dim=<span class="number">0</span>).to(<span class="variable language_">self</span>.device)</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.args.target <span class="keyword">in</span> pacs_dataset:</span><br><span class="line">                labels -= <span class="number">1</span></span><br><span class="line">            <span class="comment"># zero grad</span></span><br><span class="line">            <span class="variable language_">self</span>.encoder_optim.zero_grad()</span><br><span class="line">            <span class="variable language_">self</span>.classifier_optim.zero_grad()</span><br><span class="line">            <span class="variable language_">self</span>.classifier_ad_optim.zero_grad()</span><br><span class="line">            <span class="variable language_">self</span>.masker_optim.zero_grad()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># forward</span></span><br><span class="line">            loss_dict = &#123;&#125;</span><br><span class="line">            correct_dict = &#123;&#125;</span><br><span class="line">            num_samples_dict = &#123;&#125;</span><br><span class="line">            total_loss = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">## --------------------------step 1 : update G and C -----------------------------------</span></span><br><span class="line">            features = <span class="variable language_">self</span>.encoder(batch)</span><br><span class="line">            masks_sup = <span class="variable language_">self</span>.masker(features.detach())</span><br><span class="line">            masks_inf = torch.ones_like(masks_sup) - masks_sup</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.current_epoch &lt;= <span class="number">5</span>:</span><br><span class="line">                masks_sup = torch.ones_like(features.detach())</span><br><span class="line">                masks_inf = torch.ones_like(features.detach())</span><br><span class="line">            features_sup = features * masks_sup</span><br><span class="line">            features_inf = features * masks_inf</span><br><span class="line">            scores_sup = <span class="variable language_">self</span>.classifier(features_sup)</span><br><span class="line">            scores_inf = <span class="variable language_">self</span>.classifier_ad(features_inf)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">assert</span> batch.size(<span class="number">0</span>) % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">            split_idx = <span class="built_in">int</span>(batch.size(<span class="number">0</span>) / <span class="number">2</span>)</span><br><span class="line">            features_ori, features_aug = torch.split(features, split_idx)</span><br><span class="line">            <span class="keyword">assert</span> features_ori.size(<span class="number">0</span>) == features_aug.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># classification loss for sup feature</span></span><br><span class="line">            loss_cls_sup = criterion(scores_sup, labels)</span><br><span class="line">            loss_dict[<span class="string">&quot;sup&quot;</span>] = loss_cls_sup.item()</span><br><span class="line">            correct_dict[<span class="string">&quot;sup&quot;</span>] = calculate_correct(scores_sup, labels)</span><br><span class="line">            num_samples_dict[<span class="string">&quot;sup&quot;</span>] = <span class="built_in">int</span>(scores_sup.size(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># classification loss for inf feature</span></span><br><span class="line">            loss_cls_inf = criterion(scores_inf, labels)</span><br><span class="line">            loss_dict[<span class="string">&quot;inf&quot;</span>] = loss_cls_inf.item()</span><br><span class="line">            correct_dict[<span class="string">&quot;inf&quot;</span>] = calculate_correct(scores_inf, labels)</span><br><span class="line">            num_samples_dict[<span class="string">&quot;inf&quot;</span>] = <span class="built_in">int</span>(scores_inf.size(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># factorization loss for features between ori and aug</span></span><br><span class="line">            loss_fac = factorization_loss(features_ori,features_aug)</span><br><span class="line">            loss_dict[<span class="string">&quot;fac&quot;</span>] = loss_fac.item()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># get consistency weight</span></span><br><span class="line">            const_weight = get_current_consistency_weight(epoch=<span class="variable language_">self</span>.current_epoch,</span><br><span class="line">                                                          weight=<span class="variable language_">self</span>.config[<span class="string">&quot;lam_const&quot;</span>],</span><br><span class="line">                                                          rampup_length=<span class="variable language_">self</span>.config[<span class="string">&quot;warmup_epoch&quot;</span>],</span><br><span class="line">                                                          rampup_type=<span class="variable language_">self</span>.config[<span class="string">&quot;warmup_type&quot;</span>])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># calculate total loss</span></span><br><span class="line">            total_loss = <span class="number">0.5</span>*loss_cls_sup + <span class="number">0.5</span>*loss_cls_inf + const_weight*loss_fac</span><br><span class="line">            loss_dict[<span class="string">&quot;total&quot;</span>] = total_loss.item()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># backward</span></span><br><span class="line">            total_loss.backward()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># update</span></span><br><span class="line">            <span class="variable language_">self</span>.encoder_optim.step()</span><br><span class="line">            <span class="variable language_">self</span>.classifier_optim.step()</span><br><span class="line">            <span class="variable language_">self</span>.classifier_ad_optim.step()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">## ---------------------------------- step2: update masker------------------------------</span></span><br><span class="line">            <span class="variable language_">self</span>.masker_optim.zero_grad()</span><br><span class="line">            features = <span class="variable language_">self</span>.encoder(batch)</span><br><span class="line">            masks_sup = <span class="variable language_">self</span>.masker(features.detach())</span><br><span class="line">            masks_inf = torch.ones_like(masks_sup) - masks_sup</span><br><span class="line">            features_sup = features * masks_sup</span><br><span class="line">            features_inf = features * masks_inf</span><br><span class="line">            scores_sup = <span class="variable language_">self</span>.classifier(features_sup)</span><br><span class="line">            scores_inf = <span class="variable language_">self</span>.classifier_ad(features_inf)</span><br><span class="line"></span><br><span class="line">            loss_cls_sup = criterion(scores_sup, labels)</span><br><span class="line">            loss_cls_inf = criterion(scores_inf, labels)</span><br><span class="line">            total_loss = <span class="number">0.5</span>*loss_cls_sup - <span class="number">0.5</span>*loss_cls_inf</span><br><span class="line">            total_loss.backward()</span><br><span class="line">            <span class="variable language_">self</span>.masker_optim.step()</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.global_step += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># record</span></span><br><span class="line">            <span class="variable language_">self</span>.logger.log(</span><br><span class="line">                it=it,</span><br><span class="line">                iters=<span class="built_in">len</span>(<span class="variable language_">self</span>.train_loader),</span><br><span class="line">                losses=loss_dict,</span><br><span class="line">                samples_right=correct_dict,</span><br><span class="line">                total_samples=num_samples_dict</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># turn on eval mode</span></span><br><span class="line">        <span class="variable language_">self</span>.encoder.<span class="built_in">eval</span>()</span><br><span class="line">        <span class="variable language_">self</span>.classifier.<span class="built_in">eval</span>()</span><br><span class="line">        <span class="variable language_">self</span>.masker.<span class="built_in">eval</span>()</span><br><span class="line">        <span class="variable language_">self</span>.classifier_ad.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># evaluation</span></span><br><span class="line">        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">            <span class="keyword">for</span> phase, loader <span class="keyword">in</span> <span class="variable language_">self</span>.eval_loader.items():</span><br><span class="line">                total = <span class="built_in">len</span>(loader.dataset)</span><br><span class="line">                class_correct = <span class="variable language_">self</span>.do_eval(loader)</span><br><span class="line">                class_acc = <span class="built_in">float</span>(class_correct) / total</span><br><span class="line">                <span class="variable language_">self</span>.logger.log_test(phase, &#123;<span class="string">&#x27;class&#x27;</span>: class_acc&#125;)</span><br><span class="line">                <span class="variable language_">self</span>.results[phase][<span class="variable language_">self</span>.current_epoch] = class_acc</span><br><span class="line"></span><br><span class="line">            <span class="comment"># save from best model</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.results[<span class="string">&#x27;test&#x27;</span>][<span class="variable language_">self</span>.current_epoch] &gt;= <span class="variable language_">self</span>.best_acc:</span><br><span class="line">                <span class="variable language_">self</span>.best_acc = <span class="variable language_">self</span>.results[<span class="string">&#x27;test&#x27;</span>][<span class="variable language_">self</span>.current_epoch]</span><br><span class="line">                <span class="variable language_">self</span>.best_epoch = <span class="variable language_">self</span>.current_epoch + <span class="number">1</span></span><br><span class="line">                <span class="variable language_">self</span>.logger.save_best_model(<span class="variable language_">self</span>.encoder, <span class="variable language_">self</span>.classifier, <span class="variable language_">self</span>.best_acc)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_eval</span>(<span class="params">self, loader</span>):</span><br><span class="line">        correct = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> it, (batch, domain) <span class="keyword">in</span> <span class="built_in">enumerate</span>(loader):</span><br><span class="line">            data, labels, domains = batch[<span class="number">0</span>].to(<span class="variable language_">self</span>.device), batch[<span class="number">1</span>].to(<span class="variable language_">self</span>.device), domain.to(<span class="variable language_">self</span>.device)</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.args.target <span class="keyword">in</span> pacs_dataset:</span><br><span class="line">                labels -= <span class="number">1</span></span><br><span class="line">            features = <span class="variable language_">self</span>.encoder(data)</span><br><span class="line">            scores = <span class="variable language_">self</span>.classifier(features)</span><br><span class="line">            correct += calculate_correct(scores, labels)</span><br><span class="line">        <span class="keyword">return</span> correct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_training</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.logger = Logger(<span class="variable language_">self</span>.args, <span class="variable language_">self</span>.config, update_frequency=<span class="number">30</span>)</span><br><span class="line">        <span class="variable language_">self</span>.logger.save_config()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.epochs = <span class="variable language_">self</span>.config[<span class="string">&quot;epoch&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.results = &#123;<span class="string">&quot;val&quot;</span>: torch.zeros(<span class="variable language_">self</span>.epochs), <span class="string">&quot;test&quot;</span>: torch.zeros(<span class="variable language_">self</span>.epochs)&#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.best_acc = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.best_epoch = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="variable language_">self</span>.current_epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.epochs):</span><br><span class="line"></span><br><span class="line">            <span class="comment"># step schedulers</span></span><br><span class="line">            <span class="variable language_">self</span>.encoder_sched.step()</span><br><span class="line">            <span class="variable language_">self</span>.classifier_sched.step()</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.logger.new_epoch([group[<span class="string">&quot;lr&quot;</span>] <span class="keyword">for</span> group <span class="keyword">in</span> <span class="variable language_">self</span>.encoder_optim.param_groups])</span><br><span class="line">            <span class="variable language_">self</span>._do_epoch()</span><br><span class="line">            <span class="variable language_">self</span>.logger.finish_epoch()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># save from best model</span></span><br><span class="line">        val_res = <span class="variable language_">self</span>.results[<span class="string">&#x27;val&#x27;</span>]</span><br><span class="line">        test_res = <span class="variable language_">self</span>.results[<span class="string">&#x27;test&#x27;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.logger.save_best_acc(val_res, test_res, <span class="variable language_">self</span>.best_acc, <span class="variable language_">self</span>.best_epoch - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.logger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    args, config = get_args()</span><br><span class="line">    device = torch.device(<span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">    trainer = Trainer(args, config, device)</span><br><span class="line">    trainer.do_training()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    torch.backends.cudnn.benchmark = <span class="literal">True</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<details class="folding-tag" red><summary> 查看代码测试 </summary>
              <div class='content'>
              <p>代码要改,数据集要改,损失函数要改。目前还不会</p>
              </div>
            </details>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://Whzree.github.io">Whz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://whzree.github.io/2025/04/24/4.24%E6%8C%87%E5%AF%BC%E6%9C%AC%E7%A7%91%E7%94%9F/">https://whzree.github.io/2025/04/24/4.24%E6%8C%87%E5%AF%BC%E6%9C%AC%E7%A7%91%E7%94%9F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://Whzree.github.io" target="_blank">Whz's Note</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%99%E7%A8%8B/">教程</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/24/DarkSoul/" title="DarkSoulI-专业游戏测评"><img class="cover" src="/images/Mario/img_3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">DarkSoulI-专业游戏测评</div></div><div class="info-2"><div class="info-item-1">4月24日,晴天，是中午12点起床的 打完再写-</div></div></div></a><a class="pagination-related" href="/2025/04/25/Game/" title="GmaePot_游戏时间"><img class="cover" src="https://p2.bahamut.com.tw/B/2KU/09/d159ecc39830f445685aecf3031txjh5.JPG?w=1000" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">GmaePot_游戏时间</div></div><div class="info-2"><div class="info-item-1">4月25日,打了一天游戏。 </div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/05/14/514/" title="猪肉价格预测作业"><img class="cover" src="/images/Mario/514s.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">猪肉价格预测作业</div></div><div class="info-2"><div class="info-item-1">5月14日,写一下猪肉预测价格的作业CNN+LSTM+GRU时间序列模型 作业的两大挑战特征处理(Out-Of-Distribution)  模型构建(Nosiy-Labels)  爬取数据集 偏标记构造函数                              ...</div></div></div></a><a class="pagination-related" href="/2025/04/26/BackHome/" title="Home_back_回家时间"><img class="cover" src="/images/Mario/514.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-26</div><div class="info-item-2">Home_back_回家时间</div></div><div class="info-2"><div class="info-item-1">4月26日,坐火车回家 </div></div></div></a><a class="pagination-related" href="/2025/04/25/Game/" title="GmaePot_游戏时间"><img class="cover" src="https://p2.bahamut.com.tw/B/2KU/09/d159ecc39830f445685aecf3031txjh5.JPG?w=1000" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-25</div><div class="info-item-2">GmaePot_游戏时间</div></div><div class="info-2"><div class="info-item-1">4月25日,打了一天游戏。 </div></div></div></a><a class="pagination-related" href="/2025/04/22/Mark-down/" title="Markdown入门基础"><img class="cover" src="https://p2.bahamut.com.tw/B/2KU/30/03892af40087dc2521e010ea321ts8e5.JPG?w=1000" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-22</div><div class="info-item-2">Markdown入门基础</div></div><div class="info-2"><div class="info-item-1">4月22日,阴天,是上午12点起床的 Markdown是什么 要表示标题,只需要在短语面前添加一个井号即可。或者要加粗一个短语只须在短语前后各加两个星号即可 Markdown是独立于平台的,可以在任何操作系统的任何设备上创建Markdown格式的文本 Markdown文档,速查文档Markdown语法教程  2.1标题不同数量的’#’可以完成不同的标题,如下: 一级标题二级标题三级标题2.2 字体粗体，斜体，粗体和斜体，删除线，需要在文字前后加不同的标记符号。如下：这是粗体这是斜体这是粗体加斜体这里想用删除线注：如果想给字体换颜色,或者字体居中显示,需要使用内嵌HTML来实现。 这段文字是红色的！ 这段文字是蓝色的。  2.3 无序列表无序列表的使用,在符号’-‘后加空格使用。如下：  无序列表 1 无序列表 2 无序列表 3如果要控制列表的层级,则需要在符号’-‘前使用空格。如下： 无序列表 1 无序列表 2 无序列表 2.1 无序列表 2.2    2.4 有序列表有序列表的使用,在数字及符号’.’后面加空格后输入内容,如下：  有序列表 1 有序列表 2 有序列表...</div></div></div></a><a class="pagination-related" href="/2025/04/23/LSTM/" title="LSTM入门教程"><img class="cover" src="https://truth.bahamut.com.tw/s01/202504/forum/60440/7e58afda18c2f1a518b7282b45456143.JPG" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-23</div><div class="info-item-2">LSTM入门教程</div></div><div class="info-2"><div class="info-item-1">4月23日,晴天,是上午10点起床的今天的任务,尝试着美化一下页面 LSTM的深度学习作业今天抽空面向kimi编程写完交一下 // FileName: LSTM.py#!/usr/bin/env python# -*- coding:UTF-8 -*-&#x27;&#x27;&#x27;@Project:pythonProject1@File:LSTM3.py@IDE:pythonProject1@Author:whz@Date:2025/4/23 10:20&#x27;&#x27;&#x27;# 设置支持中文的字体#预测未来的8个值#跳步时间窗口#预测未来多个数值&quot;&quot;&quot;数据集查看以及分析：Server, Value, Timestamp, Questionable, Annotated, Substituteddata =...</div></div></div></a><a class="pagination-related" href="/2025/04/19/hello-world/" title="Hello World"><img class="cover" src="https://truth.bahamut.com.tw/s01/202204/1a09b146efb15bb2d8c8372f6bf9ade4.JPG" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-19</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Whz’s Note! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post$ hexo new &quot;My New Post&quot; More info: Writing Run server$ hexo server More info: Server Generate static files$ hexo generate More info: Generating Deploy to remote sites$ hexo deploy More info: Deployment </div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="comment-switch"><span class="first-comment">Livere</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC82MDYwMS8zNzA3Mg"></div></div><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/Mario/img_1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Whz</div><div class="author-info-description">若不撇除真是苦，入能回头便成人。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Whzree"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Whzree" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="/whz1597920@gamil" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a><a class="social-icon" href="/1271596860" target="_blank" title="book"><i class="fas fa-address-book" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">4月24日,晴天,是早上12点起床的</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E4%B8%A4%E5%A4%A7%E6%8C%91%E6%88%98"><span class="toc-number">1.</span> <span class="toc-text">数据集的两大挑战</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E5%A6%82%E4%B8%8B"><span class="toc-number">2.</span> <span class="toc-text">计划如下</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%81%8F%E6%A0%87%E8%AE%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">3.</span> <span class="toc-text">偏标记代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%AD%A7%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%E5%8F%AF%E4%BB%A5%E6%94%B9%E8%BF%9B-%E8%BF%99%E9%87%8C%E6%98%AF%E5%9F%BA%E7%A1%80%E6%B6%88%E6%AD%A7%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0-baseline-Loss-Function"><span class="toc-number">3.0.1.</span> <span class="toc-text">消歧损失函数可以改进,这里是基础消歧损失函数,baseline Loss Function</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%86%E5%9F%9F%E5%A4%96%E6%B3%9B%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="toc-number">4.</span> <span class="toc-text">领域外泛化代码</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/14/514/" title="猪肉价格预测作业"><img src="/images/Mario/514s.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="猪肉价格预测作业"/></a><div class="content"><a class="title" href="/2025/05/14/514/" title="猪肉价格预测作业">猪肉价格预测作业</a><time datetime="2025-05-14T02:48:20.420Z" title="发表于 2025-05-14 10:48:20">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/26/BackHome/" title="Home_back_回家时间"><img src="/images/Mario/514.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Home_back_回家时间"/></a><div class="content"><a class="title" href="/2025/04/26/BackHome/" title="Home_back_回家时间">Home_back_回家时间</a><time datetime="2025-04-26T02:22:30.763Z" title="发表于 2025-04-26 10:22:30">2025-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/25/Game/" title="GmaePot_游戏时间"><img src="https://p2.bahamut.com.tw/B/2KU/09/d159ecc39830f445685aecf3031txjh5.JPG?w=1000" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GmaePot_游戏时间"/></a><div class="content"><a class="title" href="/2025/04/25/Game/" title="GmaePot_游戏时间">GmaePot_游戏时间</a><time datetime="2025-04-25T10:22:16.428Z" title="发表于 2025-04-25 18:22:16">2025-04-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/24/4.24%E6%8C%87%E5%AF%BC%E6%9C%AC%E7%A7%91%E7%94%9F/" title="带带大师兄营业了"><img src="https://p2.bahamut.com.tw/B/2KU/23/dc4ae8f8e7b1e6ba410795ebb51to275.JPG?w=1000" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="带带大师兄营业了"/></a><div class="content"><a class="title" href="/2025/04/24/4.24%E6%8C%87%E5%AF%BC%E6%9C%AC%E7%A7%91%E7%94%9F/" title="带带大师兄营业了">带带大师兄营业了</a><time datetime="2025-04-24T09:14:01.155Z" title="发表于 2025-04-24 17:14:01">2025-04-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/24/DarkSoul/" title="DarkSoulI-专业游戏测评"><img src="/images/Mario/img_3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DarkSoulI-专业游戏测评"/></a><div class="content"><a class="title" href="/2025/04/24/DarkSoul/" title="DarkSoulI-专业游戏测评">DarkSoulI-专业游戏测评</a><time datetime="2025-04-24T04:49:18.244Z" title="发表于 2025-04-24 12:49:18">2025-04-24</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>东庙房公西庙阚公，两公门户相当，方敢并作。</div><div>南京河北京城，二地水土并分，可成霸业。✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">推荐游戏💡</p><ul class="ft-links"><li><a href="">漫威蜘蛛侠</a><a href="">黑神话悟空</a></li><li><a href="">黑暗之魂I</a><a href="">黑暗之魂II</a></li><li><a href="">黑暗之魂III</a><a href="">艾尔登法环</a></li><li><a href="">塞尔达旷野之息</a><a href="">塞尔达王国之泪</a></li><li><a href="">湖边小屋</a><a href="">湖景谷</a></li><li><a href="">星露谷物语</a><a href="">我的世界</a></li></ul></div></div></div><div class="ft-item-2"><div class="t-t-r"><p class="ft-t t-l-t">推荐电影⌛</p><ul class="ft-links"><li><a href="">致命弯道系列</a><a href="">电锯惊魂系列</a></li><li><a href="">德州电锯杀人狂</a><a href="">死神来了系列</a></li></ul></div></div></div><div class="copyright"><span><b>&copy;2025</b></span><span><b>&nbsp;&nbsp;By Whz</b></span></div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div id="workboard"></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'

  const loadLivere = (el, path) => {
    window.livereOptions = {
      refer: path || location.pathname
    }

    if (isShuoshuo) {
      window.shuoshuoComment.destroyLivere = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    if (typeof LivereTower === 'object') window.LivereTower.init()
    else {
      (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];
          if (typeof LivereTower === 'function') { return; }
          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;
          e.parentNode.insertBefore(j, e);
      })(document, 'script');
    }
  }

  if (isShuoshuo) {
    'Livere' === 'Livere'
      ? window.shuoshuoComment = { loadComment: loadLivere }
      : window.loadOtherComment = loadLivere
    return
  }

  if ('Livere' === 'Livere' || !false) {
    if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
    else loadLivere()
  } else {
    window.loadOtherComment = loadLivere
  }
})()</script><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: '',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      comment: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css')
        .then(() => import('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Livere' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Livere' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/cursor.js"></script><script async src="//at.alicdn.com/t/font_2264842_b004iy0kk2b.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script defer src="/js/emoji.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://npm.elemecdn.com/tzy-blog/lib/js/other/sakura.js"></script><script defer src="/js/runtime.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://Whzree.github.io/tags/教程/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 Whzの每日笔记 (7)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://Whzree.github.io/tags/游戏时间/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎮 Whzの游戏评测 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://Whzree.github.io/tags/Markdown/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 Whzの读书笔记 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://Whzree.github.io/tags" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(https://truth.bahamut.com.tw/s01/202503/forum/74934/8b35ae05dc6a97e2efeeb17c2281ca86.JPG?w=1000);"> <a class="categoryBar-list-link" href="categories/教程/">教程</a><span class="categoryBar-list-count">7</span><span class="categoryBar-list-descr">教程</span></li><li class="categoryBar-list-item" style="background:url(https://p2.bahamut.com.tw/B/2KU/99/af00663fcac619fcd058c1c35c1tpib5.JPG?w=1000);"> <a class="categoryBar-list-link" href="categories/游戏时间/">游戏时间</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">游戏时间</span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/23/LSTM/" alt=""><img width="48" height="48" src="https://truth.bahamut.com.tw/s01/202504/forum/60440/7e58afda18c2f1a518b7282b45456143.JPG" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-23</span><a class="blog-slider__title" href="2025/04/23/LSTM/" alt="">LSTM入门教程</a><div class="blog-slider__text">你在看也不会有什么的啦！点一篇文章试试</div><a class="blog-slider__button" href="2025/04/23/LSTM/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2025/04/24/DarkSoul/" alt=""><img width="48" height="48" src="/images/Mario/img_3.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-24</span><a class="blog-slider__title" href="2025/04/24/DarkSoul/" alt="">DarkSoulI-专业游戏测评</a><div class="blog-slider__text">你在看也不会有什么的啦！点一篇文章试试</div><a class="blog-slider__button" href="2025/04/24/DarkSoul/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '0.5s');
    arr[i].setAttribute('data-wow-delay', '0.5s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body></html>